<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de Usuário com ViaCEP</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    body {
      background-color: #f5f5f5;
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    h2 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 20px;
    }
    form {
      background-color: white;
      padding: 25px;
      border-radius: 8px;
      box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
    }
    label {
      font-weight: 500;
      margin-top: 15px;
      display: block;
      color: #333;
    }
    input, select {
      width: 100%;
      padding: 12px;
      margin: 6px 0 18px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      transition: border-color 0.3s;
    }
    input:focus, select:focus {
      border-color: #3498db;
      outline: none;
      box-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
    }
    button {
      background-color: #3498db;
      color: white;
      padding: 14px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-right: 12px;
      transition: background-color 0.3s;
    }
    button[type="reset"] {
      background-color: #e74c3c;
    }
    button:hover {
      opacity: 0.9;
    }
    .cep-container {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    .cep-container input {
      flex: 1;
    }
    .cep-container button {
      width: auto;
      margin-bottom: 18px;
      white-space: nowrap;
    }
    #mensagem {
      margin-top: 20px;
      padding: 12px;
      border-radius: 4px;
      text-align: center;
      font-weight: 500;
    }
    .sucesso {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .erro {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    .endereco-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0 20px;
    }
    .endereco-group label,
    .endereco-group input {
      grid-column: span 1;
    }
    .endereco-group .full-width {
      grid-column: span 2;
    }
    @media (max-width: 600px) {
      .endereco-group {
        grid-template-columns: 1fr;
      }
      .endereco-group .full-width {
        grid-column: span 1;
      }
    }
  </style>
</head>
<body>
  <h2>Cadastro de Usuário</h2>
  <form id="formCadastro" onsubmit="return validarFormulario()">

    <label for="nome">Nome completo:</label>
    <input type="text" id="nome" required>

    <label for="nascimento">Data de nascimento:</label>
    <input type="date" id="nascimento" required>

    <label for="sexo">Sexo:</label>
    <select id="sexo" required>
      <option value="">Selecione</option>
      <option value="Masculino">Masculino</option>
      <option value="Feminino">Feminino</option>
      <option value="Não informa">Prefiro não informar</option>
    </select>

    <label for="mae">Nome da mãe:</label>
    <input type="text" id="mae" required>

    <label for="cpf">CPF:</label>
    <input type="text" id="cpf" maxlength="14" placeholder="000.000.000-00" required>

    <label for="email">E-mail:</label>
    <input type="email" id="email" required>

    <label for="celular">Celular:</label>
    <input type="tel" id="celular" placeholder="(00) 00000-0000" required>

    <label for="cep">CEP:</label>
    <div class="cep-container">
      <input type="text" id="cep" maxlength="9" placeholder="00000-000" required>
      <button type="button" onclick="pesquisacep(document.getElementById('cep').value)">Buscar CEP</button>
    </div>

    <div class="endereco-group">
      <label for="rua" class="full-width">Rua:</label>
      <input type="text" id="rua" class="full-width" required>
      
      <label for="numero">Número:</label>
      <label for="complemento">Complemento:</label>
      <input type="text" id="numero">
      <input type="text" id="complemento">
      
      <label for="bairro">Bairro:</label>
      <input type="text" id="bairro" required>
      
      <label for="cidade">Cidade:</label>
      <input type="text" id="cidade" required>
      
      <label for="uf">Estado:</label>
      <input type="text" id="uf" maxlength="2" required>
    </div>

    <label for="login">Login:</label>
    <input type="text" id="login" required>

    <label for="senha">Senha:</label>
    <input type="password" id="senha" required>

    <label for="confirmarSenha">Confirmar senha:</label>
    <input type="password" id="confirmarSenha" required>

    <button type="submit">Enviar</button>
    <button type="reset" onclick="limpa_formulário_cep()">Limpar</button>

    <p id="mensagem"></p>
  </form>

  <script>
    // Formatação do CEP
    document.getElementById('cep').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 5) {
        value = value.substring(0, 5) + '-' + value.substring(5, 8);
      }
      e.target.value = value;
    });

    // Formatação do CPF
    document.getElementById('cpf').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 9) {
        value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6, 9) + '-' + value.substring(9, 11);
      } else if (value.length > 6) {
        value = value.substring(0, 3) + '.' + value.substring(3, 6) + '.' + value.substring(6);
      } else if (value.length > 3) {
        value = value.substring(0, 3) + '.' + value.substring(3);
      }
      e.target.value = value;
    });

    // Formatação do celular
    document.getElementById('celular').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 10) {
        value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
      } else if (value.length > 6) {
        value = value.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
      } else if (value.length > 2) {
        value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
      }
      e.target.value = value;
    });

    // Funções do ViaCEP
    function limpa_formulário_cep() {
      document.getElementById('rua').value = "";
      document.getElementById('bairro').value = "";
      document.getElementById('cidade').value = "";
      document.getElementById('uf').value = "";
      document.getElementById('numero').value = "";
      document.getElementById('complemento').value = "";
    }

    function meu_callback(conteudo) {
      const mensagem = document.getElementById('mensagem');
      
      if (!("erro" in conteudo)) {
        document.getElementById('rua').value = conteudo.logradouro;
        document.getElementById('bairro').value = conteudo.bairro;
        document.getElementById('cidade').value = conteudo.localidade;
        document.getElementById('uf').value = conteudo.uf;
        
        mensagem.textContent = 'Endereço preenchido automaticamente!';
        mensagem.className = 'sucesso';
      } else {
        limpa_formulário_cep();
        mensagem.textContent = 'CEP não encontrado.';
        mensagem.className = 'erro';
      }
    }

    function pesquisacep(valor) {
      const cep = valor.replace(/\D/g, '');
      const mensagem = document.getElementById('mensagem');
      
      if (cep.length !== 8) {
        mensagem.textContent = 'Formato de CEP inválido.';
        mensagem.className = 'erro';
        return;
      }
      
      mensagem.textContent = 'Buscando CEP...';
      mensagem.className = 'info';
      
      fetch(`https://viacep.com.br/ws/${cep}/json/`)
        .then(response => response.json())
        .then(data => meu_callback(data))
        .catch(error => {
          mensagem.textContent = 'Erro ao consultar o CEP. Tente novamente.';
          mensagem.className = 'erro';
          console.error('Erro:', error);
        });
    }

    // Validação de CPF
    function validarCPF(cpf) {
      cpf = cpf.replace(/\D/g, '');
      if (cpf.length !== 11 || /^(\d)\1+$/.test(cpf)) return false;

      let soma = 0;
      for (let i = 0; i < 9; i++) soma += parseInt(cpf[i]) * (10 - i);
      let resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf[9])) return false;

      soma = 0;
      for (let i = 0; i < 10; i++) soma += parseInt(cpf[i]) * (11 - i);
      resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf[10])) return false;

      return true;
    }

    // Validação do formulário
    function validarFormulario() {
      const nome = document.getElementById("nome").value;
      const nascimento = document.getElementById("nascimento").value;
      const sexo = document.getElementById("sexo").value;
      const mae = document.getElementById("mae").value;
      const cpf = document.getElementById("cpf").value;
      const email = document.getElementById("email").value;
      const celular = document.getElementById("celular").value;
      const cep = document.getElementById("cep").value;
      const rua = document.getElementById("rua").value;
      const bairro = document.getElementById("bairro").value;
      const cidade = document.getElementById("cidade").value;
      const uf = document.getElementById("uf").value;
      const login = document.getElementById("login").value;
      const senha = document.getElementById("senha").value;
      const confirmarSenha = document.getElementById("confirmarSenha").value;
      const mensagem = document.getElementById("mensagem");

      // Validação do CPF
      if (!validarCPF(cpf)) {
        mensagem.textContent = "CPF inválido.";
        mensagem.className = "erro";
        return false;
      }

      // Validação das senhas
      if (senha !== confirmarSenha) {
        mensagem.textContent = "As senhas não coincidem.";
        mensagem.className = "erro";
        return false;
      }

      // Validação do CEP
      if (cep.replace(/\D/g, '').length !== 8) {
        mensagem.textContent = "CEP inválido.";
        mensagem.className = "erro";
        return false;
      }

      // Salvar dados mínimos no localStorage (login/senha)
      localStorage.setItem("usuario", login);
      localStorage.setItem("senha", senha);

      mensagem.textContent = "Cadastro realizado com sucesso! Redirecionando...";
      mensagem.className = "sucesso";

      setTimeout(() => {
        window.location.href = "index.html";
      }, 2000);

      return false;
    }
  </script>
</body>
</html>